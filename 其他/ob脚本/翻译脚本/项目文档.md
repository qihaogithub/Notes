# Obsidian 插件翻译脚本

## 1. 项目概述

这是一个专为 Obsidian 插件设计的**纯人工维护词典翻译工具**，提供以下核心价值：
- **纯人工维护词典**：完全由用户手动创建和管理 TXT 格式词典，确保翻译准确性
- **仅翻译词典存在内容**：脚本仅翻译词典中已存在的文本，绝不修改未定义的文本

- **专注设置菜单**：专门针对 Obsidian 插件设置菜单相关函数进行翻译
- **零自动翻译**：完全移除自动翻译功能，避免机器翻译的不准确性
- **TXT格式支持**：使用简单的文本格式，一行原文一行翻译，易于编辑维护

## 2. 核心功能

### 2.1 TXT 格式词典管理

| 功能项 | 描述 |
|-------|------|
| 纯人工维护 | 完全由用户手动创建和编辑词典文件 |
| 简化格式 | 每对翻译占两行：原文→翻译→空行分隔 |
| 文件命名 | 词典文件名与插件文件夹名称保持一致（如 `calendar.txt`） |
| 直接编辑 | 使用任何文本编辑器直接编辑 TXT 文件 |

**词典结构示例：**
```
Set plugin name
设置插件名称

Plugin description
插件描述

Words per dot
每个点的单词数
```

**词典文件位置：**
```
词典文件/
├── calendar.txt              # Calendar 插件词典
├── obsidian-excalidraw-plugin.txt  # Excalidraw 插件词典
└── ...其他插件词典
```

### 2.2 精准翻译处理

- **仅翻译词典存在内容**：脚本仅翻译 TXT 词典中明确定义的文本
- **专注设置菜单**：专门针对 `setName()`、`setDesc()`、`addText()` 等设置相关函数
- **零自动翻译**：完全移除了自动翻译功能，避免机器翻译风险
- **安全替换**：只替换完全匹配的文本，不影响代码逻辑



### 2.4 版本检查与更新

- **插件版本监控**：自动检测 Obsidian 插件版本变化
- **词典同步**：插件更新时自动识别新增文本
- **变更提示**：生成详细的变更报告，标注新增、删除、修改的文本
- **智能合并**：保留用户已确认的翻译，只处理新增内容

## 3. 工作流程

### 3.1 纯人工维护工作流

脚本简化为单一翻译功能，工作流程如下：

#### 步骤1: 手动创建词典
1. **确定插件名称**：获取需要翻译的插件文件夹名称
2. **创建词典文件**：在 `词典文件/` 目录下创建 `{插件名称}.txt`
3. **添加翻译对**：手动添加 `source_text,translated_text` 格式的翻译

#### 步骤2: 运行翻译脚本
1. **加载词典**：读取对应插件的 TXT 词典文件
2. **扫描插件**：识别插件代码中的可翻译函数调用
3. **精准翻译**：仅替换词典中存在的文本


### 3.2 词典命名规则

词典文件必须与插件文件夹名称**完全一致**：

```
插件目录：
.obsidian/plugins/calendar/          # 插件文件夹名称

对应词典：
词典文件/calendar.txt                # 词典文件名必须匹配
```

**常见插件名称对应：**
| 插件文件夹 | 词典文件名 |
|-----------|------------|
| `calendar` | `calendar.txt` |
| `obsidian-excalidraw-plugin` | `obsidian-excalidraw-plugin.txt` |
| `dataview` | `dataview.txt` |

### 3.3 插件更新处理流程

1. **版本检测**：检查插件文件的最后修改时间和版本信息
2. **变更分析**：对比新旧版本，识别文本变更
3. **词典更新**：向 TXT 文件添加新增文本条目
4. **用户确认**：提示用户检查新增翻译内容
5. **应用更新**：使用更新后的词典重新翻译

## 4. 文件结构

```
翻译脚本项目/                       # 项目根目录
├── 翻译脚本.py                    # 主翻译脚本（仅支持翻译功能）
├── 项目文档.md                    # 项目文档
├── 词典文件/                      # TXT 词典存储目录（人工维护）
│   ├── calendar.txt              # Calendar 插件词典
│   ├── obsidian-excalidraw-plugin.txt  # Excalidraw 插件词典
│   └── ...其他插件词典
├── config.json                   # 配置文件
└── obsidan测试仓库/               # Obsidian 仓库示例
    └── .obsidian/
        └── plugins/              # 插件目录（配置路径）
            ├── calendar/
            │   ├── main.js       # 原始插件文件
            
            │   └── manifest.json
            └── obsidian-excalidraw-plugin/
                ├── main.js
                └── manifest.json
```

## 5. 配置选项

### 5.1 基础配置 (config.json)

```json
{
  "obsidian_plugins_path": "obsidan测试仓库/.obsidian/plugins",
  "dictionary_directory": "./词典文件"
}
```

**配置说明：**
- `obsidian_plugins_path`: Obsidian 插件目录路径
- `dictionary_directory`: 词典文件存储目录


### 5.2 翻译目标函数

脚本专门针对以下设置菜单相关函数进行翻译：

| 函数类型 | 函数名称 | 用途 |
|---------|----------|------|
| 设置名称 | `setName()` | 设置项的名称 |
| 设置描述 | `setDesc()` | 设置项的详细描述 |
| 文本输入 | `addText()` | 文本输入框的标签 |
| 标题设置 | `setTitle()` | 对话框标题 |
| 开关设置 | `addToggle()` | 开关选项的标签 |
| 文本区域 | `addTextArea()` | 多行文本输入 |
| 颜色选择 | `addColorPicker()` | 颜色选择器 |
| 文件建议 | `addFileSuggest()` | 文件路径输入 |
| 文件夹建议 | `addFolderSuggest()` | 文件夹路径输入 |
| 下拉选择 | `addDropDown()` | 下拉选项 |
| 滑块设置 | `addSlider()` | 数值滑块 |
| 搜索功能 | `addSearch()` | 搜索框 |
| 占位符 | `setPlaceholder()` | 输入框占位文本 |
| 工具提示 | `setTooltip()` | 鼠标悬停提示 |
| CSS类名 | `setClass()` | 样式类名设置 |

## 6. 使用指南

### 6.1 首次使用流程

1. **配置插件目录**：确保 `config.json` 中的插件路径正确
2. **创建词典文件**：在 `词典文件/` 目录下手动创建 `{插件名称}.txt`
3. **添加翻译内容**：按照 `source_text,translated_text` 格式添加翻译对
4. **运行翻译脚本**：执行翻译命令，应用人工维护的词典

### 6.2 词典创建指南

#### 手动创建词典文件
```bash
# 进入词典目录
cd 词典文件/

# 创建新的词典文件（以 calendar 插件为例）
touch calendar.txt

# 编辑词典文件，添加以下内容示例：
General Settings
一般设置

Words per dot
每个点的单词数

Start week on:
一周开始于：
```

#### 词典文件格式要求
- **编码**：UTF-8 with BOM（支持中文）
- **格式**：每对翻译占三行（原文→翻译→空行）
- **空行**：必须用空行分隔不同的翻译对
- **简洁**：直接使用文本编辑器编辑，无需特殊格式

### 6.3 命令行操作

#### 基础翻译命令

```bash
# 翻译单个插件
python 翻译脚本.py --plugins "calendar"

# 翻译多个插件（逗号分隔）
python 翻译脚本.py --plugins "calendar,obsidian-excalidraw-plugin"

# 翻译所有已发现插件
python 翻译脚本.py --all-plugins

# 指定配置文件路径
python 翻译脚本.py --plugins "calendar" --config "my-config.json"
```

#### 使用示例

```bash
# 1. 创建词典文件（TXT格式）
printf "General Settings\n一般设置\n\nWords per dot\n每个点的单词数\n\nStart week on:\n一周开始于：\n" > 词典文件/calendar.txt

# 2. 运行翻译
python3 翻译脚本.py --plugins "calendar"

# 3. 查看结果
# 插件文件中的对应文本已被翻译成中文
```

### 6.4 日常维护

1. **添加新翻译**：发现需要翻译的文本时，手动添加到对应 TXT 文件
2. **修改翻译**：根据使用体验调整现有翻译
3. **词典备份**：定期备份 `词典文件/` 目录中的重要词典

### 6.5 翻译质量建议

- **保持简洁**：设置菜单文本不宜过长
- **统一术语**：同类功能保持翻译一致性
- **考虑上下文**：结合插件功能理解原文含义
- **测试验证**：翻译后测试插件功能是否正常

## 7. 数据安全

- **只读模式**：首次扫描不修改任何文件
- **操作确认**：关键操作需要用户确认
- **错误处理**：完善的异常处理和回滚机制
- **日志记录**：详细记录所有操作历史

## 8. 故障排除

### 8.1 常见问题

| 问题 | 解决方案 |
|------|---------|
| 翻译不准确 | 检查 TXT 词典中的格式和空行分隔 |

| 版本检测错误 | 检查插件文件路径和读取权限 |
| TXT 格式错误 | 确保每对翻译用空行正确分隔 |



## 9. 扩展功能

### 9.1 计划中的功能

- **多插件支持**：同时管理多个 Obsidian 插件
- **翻译记忆**：建立通用的翻译记忆库
- **协作翻译**：支持团队共享词典
- **质量评估**：自动评估翻译质量

### 9.2 API 接口

- **词典管理**：提供 TXT 词典的导入导出接口
- **翻译服务**：可插拔的翻译服务接口
- **版本控制**：插件版本历史和变更追踪

## 10. 技术规范

### 10.1 TXT 文件格式

- **编码**：UTF-8 with BOM（支持中文）
- **格式**：每对翻译占三行（原文→翻译→空行分隔）
- **空行**：必须用空行分隔不同的翻译对
- **示例**：
```
General Settings
一般设置

Advanced Settings
高级设置

Words per dot
每个点的单词数
```



### 10.2 安全机制

- **仅词典翻译**：绝不翻译词典中不存在的文本
- **精确匹配**：只替换完全匹配的文本内容
- **代码保护**：不影响插件的 JavaScript 逻辑结构