# 重复文件清理工具

一个智能的重复文件检测和清理脚本，支持多种文件命名模式，优先保留原始文件。现在还包括空文件夹清理功能。

## 🚀 功能特点

### 重复文件清理功能
- **智能后缀识别**：支持各种常见的文件后缀格式
- **优先保留原始文件**：自动识别并保留无后缀的原始文件
- **多种后缀格式支持**：
  - 中文后缀：的副本、复件、备份
  - 英文后缀：copy、backup
  - 符号格式：(1)、[1]、_1、-1、 1、.1
  - 纯数字后缀
- **安全操作**：提供试运行模式，先预览再清理
- **用户确认机制**：删除前需要用户明确确认

### 空文件夹清理功能
- **自动检测空文件夹**：递归扫描指定目录下的所有空文件夹
- **安全的删除机制**：只删除真正的空文件夹，确保数据安全
- **试运行模式**：先预览将要删除的空文件夹列表
- **用户确认**：操作前需要用户明确确认

## 📋 使用方法

### 重复文件清理

```bash
# 清理当前目录下的重复文件
python3 clean_duplicates.py

# 清理指定目录
python3 clean_duplicates.py /path/to/folder

# 试运行模式 - 先预览将要删除的文件
python3 clean_duplicates.py --dry-run
```

### 空文件夹清理

```bash
# 清理当前目录下的空文件夹
python3 delete_empty_folders.py

# 清理指定目录
python3 delete_empty_folders.py /path/to/folder

# 试运行模式 - 先预览将要删除的空文件夹
python3 delete_empty_folders.py --dry-run
```

## 🔍 重复文件识别规则

### 识别逻辑

脚本通过以下步骤识别重复文件：

1. **提取基础名称**：移除各种后缀格式，获取文件的基础名称
2. **分组比较**：将具有相同基础名称的文件分为一组
3. **优先级排序**：在每组中优先保留无后缀的原始文件
4. **路径排序**：如果都有/都没有后缀，则优先保留路径较短的文件

### 支持的后缀格式

| 格式类型 | 示例 | 基础名称 |
|---------|------|----------|
| 中文副本 | `文件的副本.md` | `文件` |
| 中文复件 | `文件复件.md` | `文件` |
| 中文备份 | `文件备份.md` | `文件` |
| 英文copy | `文件 copy.md` | `文件` |
| 英文backup | `文件 backup.md` | `文件` |
| 括号数字 | `文件(1).md` | `文件` |
| 方括号数字 | `文件[1].md` | `文件` |
| 下划线数字 | `文件_1.md` | `文件` |
| 连字符数字 | `文件-1.md` | `文件` |
| 空格数字 | `文件 1.md` | `文件` |
| 点数字 | `文件.1.md` | `文件` |
| 纯数字 | `文件123.md` | `文件` |

## 📊 使用示例

### 重复文件清理示例

假设有以下文件：
```
文档.md
文档 2.md
文档的副本.md
文档(1).md
```

运行脚本后：
```bash
$ python3 clean_duplicates.py --dry-run

发现 1 组重复文件：

组 1: 基础名称 '文档'
  保留: ./文档.md (1,234 bytes)
  删除:
    - ./文档 2.md (1,234 bytes)
    - ./文档的副本.md (1,234 bytes)
    - ./文档(1).md (1,234 bytes)

总计将删除 3 个文件。
```

### 空文件夹清理示例

假设有以下目录结构：
```
project/
├── folder1/          # 空文件夹
├── folder2/          # 包含文件
│   └── file.txt
└── folder3/          # 空文件夹
```

运行空文件夹清理脚本：
```bash
$ python3 delete_empty_folders.py --dry-run

发现 2 个空文件夹：
  1. folder1
  2. folder3

总计将删除 2 个空文件夹。
```

## ⚙️ 技术实现

### 核心算法

1. **后缀识别函数** `extract_base_name_and_suffix()`：
   - 使用正则表达式匹配各种后缀模式
   - 按优先级顺序检查不同的后缀格式
   - 返回基础名称、是否有后缀、后缀类型

2. **文件分组函数** `find_duplicates()`：
   - 遍历目录树，收集所有文件信息
   - 按基础名称分组
   - 应用排序规则确定保留和删除的文件

3. **排序规则**：
   - 第一优先级：无后缀文件优先（`has_suffix=False`）
   - 第二优先级：路径长度短优先
   - 第三优先级：文件名长度短优先

### 安全机制

- **试运行模式**：`--dry-run` 参数允许用户先预览操作结果
- **用户确认**：实际删除前需要用户明确输入 `yes` 确认
- **错误处理**：删除过程中的错误会被捕获并报告，不会影响其他文件的删除

## 🛡️ 安全提示

1. **总是先使用试运行模式**：首次运行建议加上 `--dry-run` 参数
2. **仔细检查预览结果**：确认要保留和删除的文件列表
3. **重要文件请备份**：对于重要文件，建议在运行前进行备份
4. **注意文件路径**：脚本会优先保留路径较短的文件

## 📁 项目结构

```
/Users/qh2/Downloads/测试/
├── clean_duplicates.py     # 重复文件清理脚本
├── delete_empty_folders.py # 空文件夹清理脚本
├── README.md               # 本说明文档
├── 需求文档.md             # 需求文档
└── ...                     # 其他文件
```

## 🔧 自定义扩展

如果需要添加新的后缀格式识别，可以修改 `extract_base_name_and_suffix()` 函数中的 `suffix_patterns` 列表：

```python
suffix_patterns = [
    # 添加新的后缀模式
    (r'(.*)新的后缀$', '后缀类型'),
    # ... 其他模式
]
```

## 📞 常见问题

**Q: 重复文件清理脚本会删除不同内容的文件吗？**
A: 是的，脚本只关注文件名模式，不考虑文件内容。如果基础名称相同，即使内容不同也会被视为重复文件。

**Q: 如何恢复被删除的文件？**
A: 脚本删除的文件不会进入回收站，请确保重要文件已备份。

**Q: 空文件夹清理脚本会删除包含隐藏文件的文件夹吗？**
A: 不会，脚本会跳过以点开头的隐藏文件夹，并且只会删除完全空的文件夹。

**Q: 可以添加自定义后缀格式吗？**
A: 可以，修改 `clean_duplicates.py` 中的 `suffix_patterns` 列表即可添加新的正则表达式模式。

**Q: 为什么有些文件没有被识别为重复？**
A: 请检查后缀格式是否在支持列表中，或检查文件路径是否包含特殊字符。

## 📄 更新日志

- **v3.0**: 新增空文件夹清理脚本 `delete_empty_folders.py`，完善文档
- **v2.0**: 完善后缀识别逻辑，支持更多格式，优化保留策略
- **v1.0**: 基础重复文件检测和清理功能