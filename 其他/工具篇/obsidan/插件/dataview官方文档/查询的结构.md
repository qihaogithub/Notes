数据视图提供了[多种方法](https://blacksmithgu.github.io/obsidian-dataview/queries/dql-js-inline/)编写查询，每种方法的语法都不同。

此页提供有关如何编写数据视图查询语言(DQL)查询的信息。如果您对如何编写内联查询感兴趣，请参考[关于 DQL、 JS 和 Inlines 的内联部分](https://blacksmithgu.github.io/obsidian-dataview/queries/dql-js-inline/#inline-dql)。您可以在 [Javascript 参考](https://blacksmithgu.github.io/obsidian-dataview/api/intro/)中找到更多关于 Javascript 查询的信息。

DQL 是一种类似 SQL 的查询语言，用于在数据上创建不同的视图或计算:

- 选择输出的输出格式([查询类型](https://blacksmithgu.github.io/obsidian-dataview/queries/query-types/))
- 从某个[源](https://blacksmithgu.github.io/obsidian-dataview/reference/sources/)获取页面，例如标记、文件夹或链接
- 通过字段上的简单操作(如比较、存在性检查等)过滤页面/数据
- 转换用于显示的字段，即使用计算或拆分多值字段
- 根据字段对结果进行排序
- 根据字段对结果进行分组
- 限制你的结果计数
> [!warning]
>如果您熟悉 SQL，请阅读“ [SQL 的差异](https://blacksmithgu.github.io/obsidian-dataview/queries/differences-to-sql)”，以避免将 DQL 与 SQL 混淆。

让我们看看如何使用 DQL。
## DQL 查询的通用格式
每个查询都遵循相同的结构，包括
- 根据查询类型的不同，正好有一个查询类型，其中有零个、一个或多个[字段](https://blacksmithgu.github.io/obsidian-dataview/annotation/add-metadata/)
- 零个或一个 FROM 数据命令，其中包含一个到多个源
- 0到许多其他数据命令，根据数据命令使用一到多个表达式和/或其他信息
在高级别上，查询符合以下模式:

````
```dataview 
<查询类型> <字段> 
FROM <来源> 
<数据命令> <表达式> 
<数据命令> <表达式> 
... 
```
````
> [!note] 只有查询类型是强制的。
> 
## 选择输出格式

查询的输出格式由其查询类型决定:

1. TABLE: 每个结果有一行和一列或多列字段数据的结果表。
2. LIST: 与查询匹配的页面的项目符号列表。您可以在每个页面的文件链接旁边输出一个字段。
3. 任务: 与给定查询匹配的任务的交互式任务列表。
4. 日历: 一个日历视图，通过一个点显示每次点击的日期。

查询类型是查询中唯一的强制命令。其他所有命令都是可选的。
> [!note] 可能是记忆强烈的例子
> 根据保险库的大小，执行以下示例可能会花费很长时间，在极端情况下甚至会冻结黑曜石。建议指定 FROM 将查询执行限制为保险库文件的特定子集。请看下一节。

````
将保险库中的所有页面列为项目符号列表
```dataview 
LIST 
``` 
列出保险库中的所有任务(已完成或未完成)
```dataview 
TASK 
``` 
呈现日历视图，其中每个页面在其创建日期都表示为一个点。
```dataview 
CALENDAR file.cday 
from "4·工作"
``` 
显示了一个表格，其中包含了保险库的所有页面、它们的到期值、文件的标签以及多值字段工作时间的平均值
```dataview 
TABLE due, file.tags AS "tags", average(working-hours) 
```
````

> [!note]了解更多关于可用查询类型以及如何使用它们的信息
## 选择你的消息来源

除了查询类型之外，您还可以使用几个数据命令来帮助您限制、细化、排序或分组查询。这些查询命令之一是 FROM 语句。FROM 将源或源的组合作为参数，并将查询限制为与源匹配的一组页。
它的行为与其他数据命令不同: 您可以在查询类型之后向查询添加零个或一个 FROM 数据命令。不能添加多个 FROM 语句，也不能在其他数据命令之后添加它。

````
列出文件夹 Books 及其子文件夹中的所有页
```dataview 
LIST 
FROM "Books" 
`` 
列出包含标签 # status/open 或 # status/wip 的所有页面
```dataview 
LIST 
FROM #status/open OR #status/wip 
``` 
列出标签为#Assignment且位于文件夹“30 School”(或其子文件夹)内的所有页面，或位于文件夹“30 School/32 Homeworks”内且外向连接到School Dashboard Current to Dos
```
dataview 
LIST 
FROM (#assignment AND "30 School") OR ("30 School/32 Homeworks" AND outgoing([[School Dashboard Current To Dos]])) 
```
````
> [!note] 点击这里阅读更多关于 FROM 的信息。
> 
## 筛选、排序、分组或限制结果

除了上面解释的查询类型和数据命令 FROM 之外，您还可以使用其他几个数据命令来帮助您限制、细化、排序或分组查询结果。

除 FROM 命令之外的所有数据命令都可以按任意顺序多次使用(只要它们排在 Query Type 和 FROM 之后，如果根本没有使用 FROM 的话)。他们将按照写下的顺序被处决。

可供选择的有:

1. 如上所述。
2. WHERE: 根据笔记中的信息过滤笔记，元数据字段。
3. SORT: 根据字段和方向对结果进行排序。
4. GROUP BY: 每组将多个结果打包成一个结果行。
5. LIMIT: 将查询的结果计数限制为给定的数字。
6. FLATTEN: 根据字段或计算将一个结果拆分为多个结果。


````
列出所有具有元数据字段"due"以及"due"在今天之前的位置的页面
```dataview 
LIST 
WHERE due AND due < date(today) 
``` 
列出Vault中最近创建的10个页面，这些页面具有#status/open标签
```dataview 
LIST 
FROM #status/open SORT file.ctime DESC 
LIMIT 10 
``` 
以交互式任务列表的形式列出Vault中10个最旧和未完成的任务，并按其包含的文件进行分组，并从最旧的文件到最新的文件进行排序。
```dataview 
TASK 
WHERE !completed SORT created ASC LIMIT 10 
GROUP BY file.link 
SORT rows.file.ctime ASC 
```
````

## 例子
以下是一些示例查询。

````

```dataview
TASK
```

```dataview 
TABLE recipe-type AS "type", portions, length 
FROM #recipes 
```

```dataview 
LIST 
FROM #assignments 
WHERE status = "open" 
```

```dataview 
TABLE file.ctime, appointment.type, appointment.time, follow-ups 
FROM "30 Protocols/32 Management" 
WHERE follow-ups 
SORT appointment.time 
```

```dataview 
TABLE L.text AS "My lists" 
FROM "dailys" 
FLATTEN file.lists AS L 
WHERE contains(L.author, "Surname") 
```

```dataview 
LIST rows.c 
WHERE typeof(contacts) = "array" AND contains(contacts, [[Mr. L]]) 
SORT length(contacts) 
FLATTEN contacts as c 
SORT link(c).age ASC 
```

````
