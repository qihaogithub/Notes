
## 加载文档和其他资源

### 资源加载
onload --成功加载
onerror --出现错误
#### 示例

```javascript
let img = document.createElement('img'); //创建一个新的`<img>`元素
img.src = "https://js.cx/clipart/train.gif"; 
//`img`元素添加了一个`onload`事件处理器
img.onload = function() {
  alert(`Image loaded, size ${img.width}x${img.height}`);
};
img.onerror = function() {
  alert("Error occurred while loading image");
};
```

#### 跨域策略
一个网站的脚本无法访问其他网站的内容
**要允许跨源访问，`<script>` 标签需要具有 `crossorigin` 特性，并且远程服务器必须提供特殊的 header。**

这里有三个级别的跨源访问：
1. **无 `crossorigin` 特性** —— 禁止访问。
2. **`crossorigin="anonymous"`** —— 如果服务器的响应带有包含 `*` 或我们的源（origin）的 header `Access-Control-Allow-Origin`，则允许访问。浏览器不会将授权信息和 cookie 发送到远程服务器。
3. **`crossorigin="use-credentials"`** —— 如果服务器发送回带有我们的源的 header `Access-Control-Allow-Origin` 和 `Access-Control-Allow-Credentials: true`，则允许访问。浏览器会将授权信息和 cookie 发送到远程服务器。

####  预加载图片
```JavaScript
function preloadImages(sources, callback) {
      let counter = 0;
      function onLoad() {
        counter++;
        if (counter == sources.length) callback();
      }
      for(let source of sources) {
        let img = document.createElement('img');
        img.onload = img.onerror = onLoad;
        img.src = source;
      }
    }
    // ---------- The test ----------
    let sources = [
      "https://en.js.cx/images-load/1.jpg",
      "https://en.js.cx/images-load/2.jpg",
      "https://en.js.cx/images-load/3.jpg"
    ];

  

    // add random characters to prevent browser caching

    for (let i = 0; i < sources.length; i++) {
      sources[i] += '?' + Math.random();
    }

    // for each image,
    // let's create another img with the same src and check that we have its width
    function testLoaded() {
      let widthSum = 0;
      for (let i = 0; i < sources.length; i++) {
        let img = document.createElement('img');
        img.src = sources[i];
        widthSum += img.width;
      }
      alert(widthSum);
    }


    // should output 300

    preloadImages(sources, testLoaded);
```